[{"appcode":"function OnUpdate(doc, meta) {\n    let new_doc = {};\n    let bill_addr = {};\n    let mail_addr = {};\n    \n    new_doc['first_name'] = doc.first_name;\n    new_doc['last_name'] = doc.last_name;\n    new_doc['email'] = doc.email;\n    new_doc['phone'] = doc.phone;\n    new_doc['company_name'] = doc.company_name;\n\n    bill_addr = bkt_addr[doc.billing_address_id];\n    mail_addr = bkt_addr[doc.shipping_address_id];\n    \n    bill_addr['city'] = bkt_pc[bkt_addr[doc.billing_address_id].postal_code].city;\n    mail_addr['city'] = bkt_pc[bkt_addr[doc.shipping_address_id].postal_code].city;\n\n    bill_addr['state'] = bkt_pc[bkt_addr[doc.billing_address_id].postal_code].province;\n    mail_addr['state'] = bkt_pc[bkt_addr[doc.shipping_address_id].postal_code].province;\n\n    new_doc['billing_address'] = bill_addr;\n    new_doc['mailing_address'] = mail_addr;\n    \n    log(new_doc);\n\n    dest_bkt[doc.email] = new_doc;\n    \n    // Delete existing customer (leave address/postal_code for other customers who share this)\n    // delete bkt_cust[meta.id];\n    log(\"Doc created/updated\", meta.id);\n}\n\nfunction OnDelete(meta, options) {\n    log(\"Doc deleted/expired\", meta.id);\n}","depcfg":{"buckets":[{"alias":"bkt_cust","bucket_name":"schema1","scope_name":"_default","collection_name":"customers","access":"rw"},{"alias":"bkt_addr","bucket_name":"schema1","scope_name":"_default","collection_name":"addresses","access":"r"},{"alias":"bkt_pc","bucket_name":"schema1","scope_name":"_default","collection_name":"postal_codes","access":"r"},{"alias":"dest_bkt","bucket_name":"customer","scope_name":"_default","collection_name":"_default","access":"rw"}],"source_bucket":"schema1","source_scope":"_default","source_collection":"customers","metadata_bucket":"eventing_merge","metadata_scope":"_default","metadata_collection":"_default"},"version":"evt-7.0.3-7031-ee","enforce_schema":false,"handleruuid":163496727,"function_instance_id":"50jtb1","appname":"schema1_merge","settings":{"cluster_stats":null,"dcp_stream_boundary":"everything","deployment_status":false,"description":"","execution_timeout":60,"language_compatibility":"6.6.2","log_level":"INFO","n1ql_consistency":"none","num_timer_partitions":128,"processing_status":false,"timer_context_size":1024,"user_prefix":"eventing","worker_count":2}}]